<html>
<body>
<h2>Diagn√≥stico WebSocket</h2>
<button onclick="probarConexion()">Probar Conexi√≥n</button>
<div id="resultado"></div>

<script>
async function probarConexion() {
    const resultado = document.getElementById('resultado');
    resultado.innerHTML = 'üîç Probando...';
    
    const token = 'bd3933852ea0edd0321937344f2c5a2dcc446213857230954ce3dd58ac4810be';
    
    // Probar diferentes URLs
    const urls = [
        'wss://positron4tx.ddns.net:7070',
        'ws://positron4tx.ddns.net:7070', 
        'ws://localhost:7070'
    ];
    
    for (let url of urls) {
        resultado.innerHTML += `<br><br>üîó Probando: ${url}`;
        
        try {
            const ws = new WebSocket(url + '?token=' + token);
            
            await new Promise((resolve, reject) => {
                ws.onopen = () => {
                    resultado.innerHTML += '<br>‚úÖ CONECTADO';
                    ws.send(JSON.stringify({type: 'test', content: 'ping'}));
                    setTimeout(() => ws.close(), 1000);
                    resolve();
                };
                
                ws.onerror = (e) => {
                    resultado.innerHTML += '<br>‚ùå ERROR: ' + e.type;
                    reject(e);
                };
                
                ws.onclose = (e) => {
                    resultado.innerHTML += '<br>üîå Cerrado: ' + e.code;
                };
                
                // Timeout despu√©s de 3 segundos
                setTimeout(() => {
                    if (ws.readyState !== WebSocket.OPEN) {
                        resultado.innerHTML += '<br>‚è∞ TIMEOUT';
                        ws.close();
                        reject(new Error('Timeout'));
                    }
                }, 3000);
            });
            
        } catch (e) {
            resultado.innerHTML += '<br>‚ùå FALL√ì: ' + e.message;
        }
    }
    
    resultado.innerHTML += '<br><br>üéØ Diagn√≥stico completo';
}
</script>
</body>
</html>